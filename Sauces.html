<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>é†¬æ–™æ¨è–¦ç³»çµ±</title>
  <style>
    body {
      font-family: sans-serif;
      margin: 0;
      padding: 0;
      background-color: #FFF5F5;
    }
    .container {
      max-width: 900px;
      margin: 60px auto 40px;
      padding: 20px;
      background-color: #ffffff;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    h1 {
      text-align: center;
      margin-bottom: 30px;
      color: #E60012;
    }
    .tabs {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin-bottom: 20px;
    }
    .tab, #submit-open-button {
      padding: 10px 20px;
      cursor: pointer;
      border: 1px solid #E60012;
      border-bottom: none;
      border-radius: 8px 8px 0 0;
      color: #E60012;
      background-color: #fff;
      transition: all 0.3s ease;
    }
    .tab:hover, #submit-open-button:hover {
      background-color: #E60012;
      color: #fff;
    }
    .tab.active {
      background-color: #E60012;
      color: #fff;
    }
    .search-container {
      display: flex;
      justify-content: center;
      margin: 30px 0 20px;
    }
    .search-container input {
      flex: 1;
      max-width: 400px;
      padding: 10px;
      font-size: 16px;
      border: 1px solid #E60012;
      border-radius: 5px 0 0 5px;
    }
    .search-container button {
      padding: 10px 20px;
      font-size: 16px;
      border: 1px solid #E60012;
      border-left: none;
      border-radius: 0 5px 5px 0;
      background-color: #E60012;
      color: #fff;
      cursor: pointer;
    }
    .search-container button:hover {
      background-color: #fff;
      color: #E60012;
    }
    #results {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
      gap: 15px;
    }
    .card {
      border: 1.5px solid #E60012;
      border-radius: 8px;
      padding: 15px;
      box-shadow: 2px 2px 5px rgba(0,0,0,0.05);
      background: #FFFDFD;
      transition: transform 0.3s ease;
    }
    .card:hover {
      transform: translateY(-5px);
    }
    .card h3 {
      margin: 0 0 10px;
      font-size: 18px;
      color: #B00000;
    }
    .card p {
      margin: 5px 0;
      font-size: 14px;
      color: #444;
    }
    #submit-form {
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0,0,0,0.4);
      display: none;
      justify-content: center;
      align-items: center;
      animation: fadeIn 0.3s ease forwards;
    }
    #submit-form .form-box {
      background: #fff;
      padding: 30px 70px; 
      border-radius: 12px;
      max-width: 450px;
      width: 95%;
      animation: slideUp 0.3s ease forwards;
    }
    #submit-form select, #submit-form input, #submit-form textarea {
      width: 100%;
      margin-bottom: 14px;
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 6px;
    }
    #submit-button, #cancel-button {
      width: 48%;
      padding: 10px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
    }
    #submit-button {
      background-color: #E60012;
      color: white;
    }
    #cancel-button {
      background-color: #ccc;
    }
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    @keyframes slideUp {
      from { transform: translateY(50px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>é†¬æ–™å°å·¥å…·</h1>
    <div class="tabs">
      <div class="tab active" data-category="sauce">é†¬æ–™ç¸½è¦½</div>
      <div class="tab" data-category="broth">é‹åº•ç¸½è¦½</div>
      <button id="submit-open-button">æˆ‘è¦æŠ•ç¨¿</button>
    </div>
    <div class="search-container">
      <input type="text" id="flavor-input" placeholder="è«‹è¼¸å…¥æƒ³è¦çš„å£å‘³ï¼šè¾£çš„é‹åº•ã€é…¸çš„é†¬æ–™ç­‰" />
      <button id="search-button">æœå°‹</button>
    </div>
    <div id="results"></div>
  </div>

  <div id="submit-form">
    <div class="form-box">
      <h3>æŠ•ç¨¿é†¬æ–™&é‹åº•</h3>
      <select id="submit-category">
        <option value="sauce">é†¬æ–™</option>
        <option value="broth">é‹åº•</option>
      </select>
      <input type="text" id="submit-name" placeholder="åç¨± (ä¾‹ï¼šæµ·åº•æ’ˆæœ€å¥½åƒçš„é†¬æ–™)" required />
      <input type="text" id="submit-ingredients" placeholder="æ‰€éœ€é†¬æ–™ (ä¾‹ï¼šè ”æ²¹ä¸€å‹ºã€æµ·é®®å‘³ç¢Ÿå…©å‹º)" required />
      <div id="description-wrapper">
        <textarea id="submit-description" placeholder="æè¿°ï¼ˆå¯ç•™ç©ºï¼‰"></textarea>
      </div>
      <input type="text" id="submit-taste" placeholder="å£å‘³ (ä¾‹ï¼š#é…¸#ç”œ)" required />
      <div style="display:flex; justify-content: space-between;">
        <button id="submit-button">é€å‡º</button>
        <button id="cancel-button" onclick="closeForm()">å–æ¶ˆ</button>
      </div>
    </div>
  </div>

  <script>
    let currentCategory = 'sauce';

    function renderResults(data) {
      const container = document.getElementById('results');
      container.innerHTML = '';
      if (!data.length) {
        container.innerHTML = '<p>ç›®å‰ç„¡ç¬¦åˆæ¢ä»¶çš„é …ç›®ã€‚</p>';
        return;
      }
      data.forEach(item => {
        const card = document.createElement('div');
        card.className = 'card';
        const name = item.name;
        const description = item.description;
        const taste = item.taste || '';
        const intro = item.intro || '';
        if (currentCategory === 'sauce') {
          card.innerHTML = `
            <h3>${name}</h3>
            <p>æ‰€éœ€é†¬æ–™ï¼š${description}</p>
            ${taste ? `<p>å£å‘³ï¼š${taste}</p>` : ''}
            ${intro ? `<p>ä»‹ç´¹ï¼š${intro}</p>` : ''}
          `;
        } else {
          card.innerHTML = `
            <h3>${name}</h3>
            <p>é‹åº•é…æ–¹ï¼š${description}</p>
            ${taste ? `<p>å£å‘³ï¼š${taste}</p>` : ''}
          `;
        }
        container.appendChild(card);
      });
    }

    function loadItems(query = '') {
      const container = document.getElementById('results');
      container.innerHTML = '<p style="text-align:center;">ğŸ² è¼‰å…¥ä¸­...</p>';
      const params = new URLSearchParams();
      if (query) params.append('query', query);
      params.append('category', currentCategory);
      fetch(`https://script.google.com/macros/s/AKfycbxU76zx0eLPtGb5EzjWh6gRyWfuKqlUgZaTXYsaec6YFQUKsG3wA_OeHjin0PzCwQ-M1w/exec?${params.toString()}`)
        .then(res => res.json())
        .then(data => renderResults(data))
        .catch(err => {
          container.innerHTML = '<p style="text-align:center;color:red;">âŒ è¼‰å…¥å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦</p>';
          console.error('è¼‰å…¥å¤±æ•—', err);
        });
    }

    function handleSearch() {
  let input = document.getElementById('flavor-input').value.trim();
  if (!input) {
    alert('è«‹è¼¸å…¥å£å‘³é—œéµå­—å†æœå°‹ï¼');
    return;
  }

  
  const flavorKeywords = ['é…¸', 'è¾£', 'éº»', 'ç”œ', 'é¦™', 'é¹¹', 'è‹¦', 'æ¿ƒ', 'æ·¡', 'è’œ'];

  
  const matched = flavorKeywords.filter(keyword => input.includes(keyword));

  const query = matched.length > 0 ? matched.join(' ') : input;

  loadItems(query);
}


    function openForm() {
      document.getElementById('submit-form').style.display = 'flex';
      document.getElementById('submit-category').value = currentCategory;
      document.getElementById('submit-category').dispatchEvent(new Event('change'));
    }

    function closeForm() {
      document.getElementById('submit-form').style.display = 'none';
    }

    document.getElementById('submit-open-button').addEventListener('click', openForm);

    document.getElementById('submit-category').addEventListener('change', () => {
      const category = document.getElementById('submit-category').value;
      const descWrapper = document.getElementById('description-wrapper');
      if (category === 'broth') {
        descWrapper.style.display = 'none';
      } else {
        descWrapper.style.display = 'block';
      }
    });

    document.getElementById('submit-button').addEventListener('click', () => {
      const category = document.getElementById('submit-category').value;
      const name = document.getElementById('submit-name').value.trim();
      const ingredients = document.getElementById('submit-ingredients').value.trim();
      const description = document.getElementById('submit-description').value.trim();
      const taste = document.getElementById('submit-taste').value.trim();

      if (!name || !ingredients || !taste) {
        alert('è«‹å¡«å¯«å¿…å¡«æ¬„ä½ï¼ˆåç¨±ã€æ‰€éœ€é†¬æ–™ã€å£å‘³ï¼‰');
        return;
      }

      const postData = {
        category,
        name,
        ingredients,
        description,
        taste
      };

      fetch('https://script.google.com/macros/s/AKfycbxU76zx0eLPtGb5EzjWh6gRyWfuKqlUgZaTXYsaec6YFQUKsG3wA_OeHjin0PzCwQ-M1w/exec', {
        method: 'POST',
        body: JSON.stringify(postData),
        headers: {
          'Content-Type': 'application/json'
        }
      })
      .then(res => res.json())
      .then(data => {
        alert('âœ… æŠ•ç¨¿æˆåŠŸï¼Œç­‰å¾…å¯©æ ¸ï¼');
        closeForm();
        document.getElementById('submit-name').value = '';
        document.getElementById('submit-ingredients').value = '';
        document.getElementById('submit-description').value = '';
        document.getElementById('submit-taste').value = '';
      })
      .catch(err => {
        alert('âŒ æŠ•ç¨¿å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦');
        console.error(err);
      });
    });

    document.getElementById('search-button').addEventListener('click', handleSearch);
    document.getElementById('flavor-input').addEventListener('keydown', (e) => {
      if (e.key === 'Enter') handleSearch();
    });

    document.querySelectorAll('.tab').forEach(tab => {
      tab.addEventListener('click', () => {
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        tab.classList.add('active');
        currentCategory = tab.dataset.category;
        document.getElementById('flavor-input').value = '';
        loadItems();
      });
    });

    document.addEventListener('DOMContentLoaded', () => loadItems());
  </script>
</body>
</html>